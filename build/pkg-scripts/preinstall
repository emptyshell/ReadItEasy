#!/bin/sh -e

if [[ -z $(command -v pwsh) ]];
then
    #/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"  > ~/installer.log

    cd /tmp
    curl -L -O https://github.com/PowerShell/PowerShell/releases/download/v7.1.3/powershell-7.1.3-osx-x64.pkg

    # sudo installer -pkg powershell-*.pkg -target /Applications
    open /tmp/powershell-*.pkg
fi

if [[ $(pwsh -c "Get-Module -listavailable | select-string -pattern 'MicrosoftTeams'") != "MicrosoftTeams" ]];
then
    if [[ $(pwsh -c "Install-Module MicrosoftTeams -Force") -eq 0 ]];
    then
        echo "Microsoft Teams Powershell module Installed successfuly" > /tmp/TVIT_installer.log
    else
        echo "Something went wrong due installing of Microsoft Teams Powershell Module" > /tmp/TVIT_installer.log
        exit 1
    fi
fi